"""
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Ñ—Ä–∞–∑ —Å –ø–æ–º–æ—â—å—é Claude AI
"""
import anthropic
from config import ANTHROPIC_API_KEY


# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
client = None
if ANTHROPIC_API_KEY:
    try:
        client = anthropic.Anthropic(api_key=ANTHROPIC_API_KEY)
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Claude: {e}")


def generate_keywords(
    category_name,
    niche,
    target_audience,
    products_services,
    location,
    goals,
    quantity=50
):
    """
    –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Ñ—Ä–∞–∑ —Å –ø–æ–º–æ—â—å—é Claude AI
    
    Args:
        category_name: –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        niche: –ù–∏—à–∞/–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞
        target_audience: –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è
        products_services: –¢–æ–≤–∞—Ä—ã/—É—Å–ª—É–≥–∏
        location: –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞
        goals: –¶–µ–ª–∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è
        quantity: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ—Ä–∞–∑ (50, 100, 150, 200)
    
    Returns:
        dict: {
            'success': bool,
            'keywords': list,
            'error': str (–µ—Å–ª–∏ –æ—à–∏–±–∫–∞)
        }
    """
    if not ANTHROPIC_API_KEY or not client:
        return {
            'success': False,
            'keywords': [],
            'error': '‚ö†Ô∏è Claude API –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –î–æ–±–∞–≤—å—Ç–µ ANTHROPIC_API_KEY –≤ .env'
        }
    
    # –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (—É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è 2.1)
    system_prompt = f"""–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π SEO-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç. –°–æ–±–∏—Ä–∞–µ—à—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —è–¥—Ä–æ –ø–æ –≤—Å–µ–º –ø—Ä–∞–≤–∏–ª–∞–º.

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê:

1. –ì–ï–ù–ï–†–ò–†–£–ô –¢–û–õ–¨–ö–û –†–ï–ê–õ–¨–ù–´–ï –ü–û–ò–°–ö–û–í–´–ï –ó–ê–ü–†–û–°–´
   - –õ—é–¥–∏ —Ä–µ–∞–ª—å–Ω–æ –∏—â—É—Ç —ç—Ç–∏ —Ñ—Ä–∞–∑—ã –≤ –Ø–Ω–¥–µ–∫—Å/Google
   - –ù–∏–∫–∞–∫–æ–π –æ—Ç—Å–µ–±—è—Ç–∏–Ω—ã –∏ —Ñ–∞–Ω—Ç–∞–∑–∏–π!
   - –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä "{products_services}" - –ø–∏—à–∏ –ø—Ä–æ –Ω–µ–≥–æ, –∞ –Ω–µ –ø—Ä–æ –¥—Ä—É–≥–∏–µ —Ç–æ–≤–∞—Ä—ã

2. –°–¢–†–£–ö–¢–£–†–ê –°–Ø (–°–¢–†–û–ì–û –°–û–ë–õ–Æ–î–ê–ô –ü–†–û–ü–û–†–¶–ò–ò):

   –ö–û–ú–ú–ï–†–ß–ï–°–ö–ò–ï –∑–∞–ø—Ä–æ—Å—ã (60% –æ—Ç –≤—Å–µ—Ö):
   ‚Ä¢ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ —Å –≥–µ–æ (30%) - –ü–†–ò–û–†–ò–¢–ï–¢:
     - [—Ç–æ–≤–∞—Ä] –∫—É–ø–∏—Ç—å –≤ [–≥–æ—Ä–æ–¥]
     - –∫—É–ø–∏—Ç—å [—Ç–æ–≤–∞—Ä] [–≥–æ—Ä–æ–¥] 
     - [—Ç–æ–≤–∞—Ä] [–≥–æ—Ä–æ–¥] —Ü–µ–Ω–∞
     - –≥–¥–µ –∫—É–ø–∏—Ç—å [—Ç–æ–≤–∞—Ä] –≤ [–≥–æ—Ä–æ–¥]
     - [—Ç–æ–≤–∞—Ä] –Ω–µ–¥–æ—Ä–æ–≥–æ [–≥–æ—Ä–æ–¥]
   
   ‚Ä¢ –° —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ –∏ –ø–æ–º–µ—â–µ–Ω–∏—è–º–∏ (30%) - LONG-TAIL:
     - [—Ç–æ–≤–∞—Ä] –¥–ª—è [–ø–æ–º–µ—â–µ–Ω–∏–µ] (—Å–ø–∞–ª—å–Ω—è, –≥–æ—Å—Ç–∏–Ω–∞—è, –∫—É—Ö–Ω—è, –≤–∞–Ω–Ω–∞—è, –ø—Ä–∏—Ö–æ–∂–∞—è)
     - [—Ç–æ–≤–∞—Ä] [—Ä–∞–∑–º–µ—Ä] –¥–ª—è [–ø–æ–º–µ—â–µ–Ω–∏–µ]
     - [—Ç–æ–≤–∞—Ä] [—Ü–≤–µ—Ç] –¥–ª—è [–ø–æ–º–µ—â–µ–Ω–∏–µ]
     - [—Ç–æ–≤–∞—Ä] [–º–∞—Ç–µ—Ä–∏–∞–ª] [—Ä–∞–∑–º–µ—Ä]
     - [—Ç–æ–≤–∞—Ä] [—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞] –∫—É–ø–∏—Ç—å
   
   –ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–´–ï –∑–∞–ø—Ä–æ—Å—ã (25% –æ—Ç –≤—Å–µ—Ö):
   ‚Ä¢ –í—ã–±–æ—Ä –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ (10%):
     - –∫–∞–∫ –≤—ã–±—Ä–∞—Ç—å [—Ç–æ–≤–∞—Ä]
     - –∫–∞–∫–æ–π [—Ç–æ–≤–∞—Ä] –ª—É—á—à–µ
     - [—Ç–æ–≤–∞—Ä] –∏–ª–∏ [–∞–Ω–∞–ª–æ–≥] —á—Ç–æ –ª—É—á—à–µ
     - [—Ç–æ–≤–∞—Ä] vs [–∞–Ω–∞–ª–æ–≥]
     - —á–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è [—Ç–æ–≤–∞—Ä] –æ—Ç [–∞–Ω–∞–ª–æ–≥]
     - –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ [—Ç–æ–≤–∞—Ä] –ø–µ—Ä–µ–¥ [–∞–Ω–∞–ª–æ–≥]
   
   ‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –º–æ–Ω—Ç–∞–∂ (7%):
     - –∫–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å [—Ç–æ–≤–∞—Ä]
     - –∫–∞–∫ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å [—Ç–æ–≤–∞—Ä]
     - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ [—Ç–æ–≤–∞—Ä] —Å–≤–æ–∏–º–∏ —Ä—É–∫–∞–º–∏
     - –º–æ–Ω—Ç–∞–∂ [—Ç–æ–≤–∞—Ä] –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
   
   ‚Ä¢ –£—Ö–æ–¥ –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è (5%):
     - –∫–∞–∫ —É—Ö–∞–∂–∏–≤–∞—Ç—å –∑–∞ [—Ç–æ–≤–∞—Ä]
     - —á–µ–º –º—ã—Ç—å [—Ç–æ–≤–∞—Ä]
     - –∫–∞–∫ —á–∏—Å—Ç–∏—Ç—å [—Ç–æ–≤–∞—Ä]
     - —Å—Ä–æ–∫ —Å–ª—É–∂–±—ã [—Ç–æ–≤–∞—Ä]
     - [—Ç–æ–≤–∞—Ä] –æ—Ç–∑—ã–≤—ã –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
   
   ‚Ä¢ –ë–∞–∑–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã (3%):
     - —á—Ç–æ —Ç–∞–∫–æ–µ [—Ç–æ–≤–∞—Ä]
     - –∑–∞—á–µ–º –Ω—É–∂–µ–Ω [—Ç–æ–≤–∞—Ä]
     - [—Ç–æ–≤–∞—Ä] –ø–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã
   
   –ù–ê–í–ò–ì–ê–¶–ò–û–ù–ù–´–ï –∑–∞–ø—Ä–æ—Å—ã (15% –æ—Ç –≤—Å–µ—Ö):
   ‚Ä¢ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–æ–≤–∞—Ä—ã:
     - [–∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞]
     - [–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è]
     - [–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä]
     - [–±—Ä–µ–Ω–¥] [—Ç–æ–≤–∞—Ä]

3. –ß–ê–°–¢–û–¢–ù–û–°–¢–¨ –ò –ö–û–ù–ö–†–ï–¢–ù–û–°–¢–¨:
   ‚Ä¢ –í–ß (1-2 —Å–ª–æ–≤–∞): 5% ‚Äî –æ–±—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   ‚Ä¢ –°–ß (2-4 —Å–ª–æ–≤–∞): 35% ‚Äî –æ—Å–Ω–æ–≤–∞ —è–¥—Ä–∞
   ‚Ä¢ –ù–ß (4-7 —Å–ª–æ–≤): 60% ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ long-tail –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ö–û–ù–ö–†–ï–¢–ù–´–ï

4. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –¢–ò–ü–´ –ó–ê–ü–†–û–°–û–í:
   ‚úÖ Long-tail –ø–æ –ø–æ–º–µ—â–µ–Ω–∏—è–º: "[—Ç–æ–≤–∞—Ä] –¥–ª—è —Å–ø–∞–ª—å–Ω–∏ 3—Ö4 –º–µ—Ç—Ä–∞"
   ‚úÖ –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–µ: "[—Ç–æ–≤–∞—Ä] –∏–ª–∏ [–∞–Ω–∞–ª–æ–≥]", "[—Ç–æ–≤–∞—Ä] vs [–∞–Ω–∞–ª–æ–≥]"
   ‚úÖ –ü–æ —É—Ö–æ–¥—É: "–∫–∞–∫ —É—Ö–∞–∂–∏–≤–∞—Ç—å –∑–∞ [—Ç–æ–≤–∞—Ä]", "—á–µ–º –º—ã—Ç—å [—Ç–æ–≤–∞—Ä]"
   ‚úÖ –° –≥–µ–æ + –∫—É–ø–∏—Ç—å: "–∫—É–ø–∏—Ç—å [—Ç–æ–≤–∞—Ä] –≤ –º–æ—Å–∫–≤–µ", "[—Ç–æ–≤–∞—Ä] –º–æ—Å–∫–≤–∞ —Ü–µ–Ω–∞"

5. –ó–ê–ü–†–ï–©–ï–ù–û –ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨:
   ‚ùå –ú—É—Å–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –ø–æ —Ç–µ–º–µ
   ‚ùå –ó–∞–ø—Ä–æ—Å—ã —Å "–∫–ª–∏–º–∞—Ç", –ø–æ–≥–æ–¥–æ–π (–µ—Å–ª–∏ –Ω–µ —Ç–µ–º–∞)
   ‚ùå –≠–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –ø—Ä–æ–¥–∞—é—Ç—Å—è
   ‚ùå –§–∞–Ω—Ç–∞–∑–∏–π–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
   ‚ùå –ó–∞–ø—Ä–æ—Å—ã –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏–∫—Ç–æ –Ω–µ –∏—â–µ—Ç
   ‚ùå –û–±—â–∏–µ —Ñ—Ä–∞–∑—ã –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏

6. –§–û–†–ú–ê–¢ –í–´–í–û–î–ê:
   - –ö–∞–∂–¥–∞—è —Ñ—Ä–∞–∑–∞ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
   - –ë–ï–ó –Ω—É–º–µ—Ä–∞—Ü–∏–∏, –ë–ï–ó –º–∞—Ä–∫–µ—Ä–æ–≤, –ë–ï–ó –ø–æ—è—Å–Ω–µ–Ω–∏–π
   - –¢–æ–ª—å–∫–æ —á–∏—Å—Ç—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–∑—ã
   - –†–û–í–ù–û {quantity} —Ñ—Ä–∞–∑"""
    
    # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç (—É–ª—É—á—à–µ–Ω–Ω—ã–π —Å long-tail –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è–º–∏)
    user_prompt = f"""–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —è–¥—Ä–æ –∏–∑ –†–û–í–ù–û {quantity} –∫–ª—é—á–µ–≤—ã—Ö —Ñ—Ä–∞–∑.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–î–ê–ù–ù–´–ï –û –ë–ò–ó–ù–ï–°–ï:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üè¢ –¢–æ–≤–∞—Ä—ã/—É—Å–ª—É–≥–∏: {products_services}
üìÇ –¢–∏–ø –±–∏–∑–Ω–µ—Å–∞: {niche}
üë• –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: {target_audience}
üìç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è: {location}
üéØ –¶–µ–ª—å: {goals}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –Ø–î–†–ê:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

1Ô∏è‚É£ –ö–û–ú–ú–ï–†–ß–ï–°–ö–ò–ï –ó–ê–ü–†–û–°–´ (~{int(quantity * 0.6)} —à—Ç):

A) –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ —Å –ì–ï–û (~{int(quantity * 0.30)} —à—Ç) - –ü–†–ò–û–†–ò–¢–ï–¢:
‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤–∫–ª—é—á–∏ —ç—Ç–∏ —Ç–∏–ø—ã:
- {products_services} –∫—É–ø–∏—Ç—å {location.split(',')[0] if location else '–º–æ—Å–∫–≤–∞'}
- –∫—É–ø–∏—Ç—å {products_services} –≤ {location.split(',')[0] if location else '–º–æ—Å–∫–≤–µ'}
- {products_services} {location.split(',')[0] if location else '–º–æ—Å–∫–≤–∞'} —Ü–µ–Ω–∞
- –≥–¥–µ –∫—É–ø–∏—Ç—å {products_services} {location.split(',')[0] if location else '–º–æ—Å–∫–≤–∞'}
- {products_services} –Ω–µ–¥–æ—Ä–æ–≥–æ {location.split(',')[0] if location else '–º–æ—Å–∫–≤–∞'}
- {products_services} —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π {location.split(',')[0] if location else '–º–æ—Å–∫–≤–∞'}
- –∑–∞–∫–∞–∑–∞—Ç—å {products_services} {location.split(',')[0] if location else '–º–æ—Å–∫–≤–∞'}

B) LONG-TAIL –ø–æ –ø–æ–º–µ—â–µ–Ω–∏—è–º (~{int(quantity * 0.30)} —à—Ç):
‚úÖ –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ö–û–ù–ö–†–ï–¢–ù–´–ï –∑–∞–ø—Ä–æ—Å—ã:
- {products_services} –¥–ª—è —Å–ø–∞–ª—å–Ω–∏
- {products_services} –¥–ª—è –≥–æ—Å—Ç–∏–Ω–æ–π 
- {products_services} –¥–ª—è –∫—É—Ö–Ω–∏
- {products_services} –¥–ª—è –≤–∞–Ω–Ω–æ–π
- {products_services} –¥–ª—è –ø—Ä–∏—Ö–æ–∂–µ–π
- {products_services} –¥–ª—è –¥–µ—Ç—Å–∫–æ–π –∫–æ–º–Ω–∞—Ç—ã
- {products_services} [—Ä–∞–∑–º–µ—Ä] –¥–ª—è [–ø–æ–º–µ—â–µ–Ω–∏–µ]
- {products_services} [—Ü–≤–µ—Ç] –¥–ª—è [–ø–æ–º–µ—â–µ–Ω–∏–µ]
- {products_services} [—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞] –∫—É–ø–∏—Ç—å

2Ô∏è‚É£ –ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–´–ï –ó–ê–ü–†–û–°–´ (~{int(quantity * 0.25)} —à—Ç):

A) –°–†–ê–í–ù–ò–¢–ï–õ–¨–ù–´–ï (~{int(quantity * 0.10)} —à—Ç) - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:
‚úÖ –í–∫–ª—é—á–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:
- {products_services} –∏–ª–∏ [–ø–æ–ø—É–ª—è—Ä–Ω—ã–π –∞–Ω–∞–ª–æ–≥] —á—Ç–æ –ª—É—á—à–µ
- {products_services} vs [–∞–Ω–∞–ª–æ–≥]
- —á–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è {products_services} –æ—Ç [–∞–Ω–∞–ª–æ–≥]
- –∫–∞–∫–æ–π {products_services} –ª—É—á—à–µ –≤—ã–±—Ä–∞—Ç—å
- –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ {products_services} –ø–µ—Ä–µ–¥ [–∞–Ω–∞–ª–æ–≥]
- {products_services} [–º–∞—Ç–µ—Ä–∏–∞–ª] –∏–ª–∏ [–º–∞—Ç–µ—Ä–∏–∞–ª]

B) –£—Å—Ç–∞–Ω–æ–≤–∫–∞/–º–æ–Ω—Ç–∞–∂ (~{int(quantity * 0.07)} —à—Ç):
- –∫–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å {products_services}
- –∫–∞–∫ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å {products_services}
- —É—Å—Ç–∞–Ω–æ–≤–∫–∞ {products_services} —Å–≤–æ–∏–º–∏ —Ä—É–∫–∞–º–∏
- –º–æ–Ω—Ç–∞–∂ {products_services} –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- {products_services} —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–Ω–∞

C) –£–•–û–î –ò –≠–ö–°–ü–õ–£–ê–¢–ê–¶–ò–Ø (~{int(quantity * 0.05)} —à—Ç) - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:
‚úÖ –í–∞–∂–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã:
- –∫–∞–∫ —É—Ö–∞–∂–∏–≤–∞—Ç—å –∑–∞ {products_services}
- —á–µ–º –º—ã—Ç—å {products_services}
- –∫–∞–∫ —á–∏—Å—Ç–∏—Ç—å {products_services}
- —Å—Ä–æ–∫ —Å–ª—É–∂–±—ã {products_services}
- {products_services} –æ—Ç–∑—ã–≤—ã –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
- –º–æ–∂–Ω–æ –ª–∏ –º—ã—Ç—å {products_services}

D) –ë–∞–∑–æ–≤—ã–µ (~{int(quantity * 0.03)} —à—Ç):
- —á—Ç–æ —Ç–∞–∫–æ–µ {products_services}
- –∑–∞—á–µ–º –Ω—É–∂–µ–Ω {products_services}
- {products_services} –ø–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã

3Ô∏è‚É£ –ù–ê–í–ò–ì–ê–¶–ò–û–ù–ù–´–ï –ó–ê–ü–†–û–°–´ (~{int(quantity * 0.15)} —à—Ç):
- [–∫–∞—Ç–µ–≥–æ—Ä–∏—è]
- [–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è]
- [–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä]
- [–±—Ä–µ–Ω–¥] {products_services}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üéØ –ü–†–ò–û–†–ò–¢–ï–¢–´ (–≤ —Ç–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ):
1. –§—Ä–∞–∑—ã "–∫—É–ø–∏—Ç—å" + –≥–µ–æ ({location}) - –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
2. Long-tail –ø–æ –ø–æ–º–µ—â–µ–Ω–∏—è–º (—Å–ø–∞–ª—å–Ω—è, –∫—É—Ö–Ω—è, –≤–∞–Ω–Ω–∞—è...)
3. –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã ([—Ç–æ–≤–∞—Ä] –∏–ª–∏ [–∞–Ω–∞–ª–æ–≥])
4. –ó–∞–ø—Ä–æ—Å—ã –ø–æ —É—Ö–æ–¥—É (–∫–∞–∫ –º—ã—Ç—å, —á–∏—Å—Ç–∏—Ç—å, —É—Ö–∞–∂–∏–≤–∞—Ç—å)

‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤–∫–ª—é—á–∏:
‚Ä¢ –ú–∏–Ω–∏–º—É–º 20% –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–º–µ—â–µ–Ω–∏—è
‚Ä¢ –ú–∏–Ω–∏–º—É–º 10% —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ ("–∏–ª–∏", "vs", "—á–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è")
‚Ä¢ –ú–∏–Ω–∏–º—É–º 5% –ø—Ä–æ —É—Ö–æ–¥ –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é
‚Ä¢ 60% —Ñ—Ä–∞–∑ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å LONG-TAIL (4-7 —Å–ª–æ–≤)

‚ùå –ù–ï –≥–µ–Ω–µ—Ä–∏—Ä—É–π:
‚Ä¢ –û–±—â–∏–µ —Ñ—Ä–∞–∑—ã –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏
‚Ä¢ –ú—É—Å–æ—Ä –ø—Ä–æ –∫–ª–∏–º–∞—Ç/–ø–æ–≥–æ–¥—É/—ç–∫–∑–æ—Ç–∏–∫—É
‚Ä¢ –¢–æ–≤–∞—Ä—ã –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –ø—Ä–æ–¥–∞—ë—Ç –±–∏–∑–Ω–µ—Å

–ù–∞—á–∏–Ω–∞–π —Å—Ä–∞–∑—É —Å –∫–ª—é—á–µ–≤—ã—Ö —Ñ—Ä–∞–∑. –í—ã–¥–∞–π –†–û–í–ù–û {quantity} —Å—Ç—Ä–æ–∫:"""
    
    try:
        # –ó–∞–ø—Ä–æ—Å –∫ Claude
        response = client.messages.create(
            model="claude-sonnet-4-20250514",
            max_tokens=12000,  # –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ 200 —Ñ—Ä–∞–∑
            system=system_prompt,
            messages=[
                {
                    "role": "user",
                    "content": user_prompt
                }
            ]
        )
        
        # –õ–æ–≥–∏—Ä—É–µ–º –∑–∞—Ç—Ä–∞—Ç—ã
        try:
            if hasattr(response, 'usage') and response.usage:
                from utils.api_cost_tracker import log_claude_usage
                log_claude_usage(
                    user_id=0,
                    input_tokens=response.usage.input_tokens,
                    output_tokens=response.usage.output_tokens,
                    model="claude-sonnet-4-20250514",
                    operation_type='keywords_generation'
                )
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞—Ç—Ä–∞—Ç: {e}")
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
        if response and response.content:
            text = response.content[0].text
            
            # –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å—Ç—Ä–æ–∫–∏ –∏ –æ—á–∏—â–∞–µ–º
            lines = text.strip().split('\n')
            keywords = []
            
            for line in lines:
                # –£–±–∏—Ä–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
                line = line.strip()
                if not line:
                    continue
                
                # –£–±–∏—Ä–∞–µ–º –Ω–æ–º–µ—Ä–∞ –∏ –º–∞—Ä–∫–µ—Ä—ã
                line = line.lstrip('0123456789.-‚Ä¢*> ')
                line = line.strip()
                
                # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ
                if len(line) < 3:
                    continue
                
                # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫–∏-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                if line.startswith('#') or line.startswith('//'):
                    continue
                
                keywords.append(line)
            
            # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω–æ–≥–æ
            keywords = keywords[:quantity]
            
            return {
                'success': True,
                'keywords': keywords,
                'total': len(keywords)
            }
        else:
            return {
                'success': False,
                'keywords': [],
                'error': 'Claude –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç'
            }
            
    except Exception as e:
        error_msg = str(e)
        if len(error_msg) > 200:
            error_msg = error_msg[:200] + "..."
        
        return {
            'success': False,
            'keywords': [],
            'error': f'–û—à–∏–±–∫–∞ Claude AI: {error_msg}'
        }


def generate_keywords_fallback(category_name, niche, quantity=50):
    """
    –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–≤—ã—Ö —Ñ—Ä–∞–∑ –µ—Å–ª–∏ Claude –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —à–∞–±–ª–æ–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –Ω–∏—à–∏
    """
    templates = [
        "{niche} –∫—É–ø–∏—Ç—å",
        "{niche} —Ü–µ–Ω–∞",
        "{niche} –∑–∞–∫–∞–∑–∞—Ç—å",
        "–≥–¥–µ –∫—É–ø–∏—Ç—å {niche}",
        "{niche} –æ—Ç–∑—ã–≤—ã",
        "{niche} –Ω–µ–¥–æ—Ä–æ–≥–æ",
        "{niche} —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π",
        "–ª—É—á—à–∏–π {niche}",
        "{niche} –¥–ª—è –¥–æ–º–∞",
        "{niche} –¥–ª—è –æ—Ñ–∏—Å–∞",
        "–∫–∞–∫ –≤—ã–±—Ä–∞—Ç—å {niche}",
        "{niche} –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π",
        "{niche} –¥–µ—à–µ–≤–æ",
        "{niche} –æ–ø—Ç–æ–º",
        "{niche} –≤ —Ä–æ–∑–Ω–∏—Ü—É",
        "–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π {niche}",
        "{niche} —Ç–æ–ø",
        "{niche} —Ä–µ–π—Ç–∏–Ω–≥",
        "{niche} —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ",
        "{niche} —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏",
    ]
    
    keywords = []
    niche_lower = niche.lower()
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ñ—Ä–∞–∑—ã –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤
    for template in templates:
        keyword = template.format(niche=niche_lower)
        keywords.append(keyword)
        
        if len(keywords) >= quantity:
            break
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤–∞—Ä–∏–∞—Ü–∏–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ
    if len(keywords) < quantity:
        variations = [
            f"{niche_lower} –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –º–∞–≥–∞–∑–∏–Ω",
            f"{niche_lower} –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç",
            f"{niche_lower} –∫–∞—Ç–∞–ª–æ–≥",
            f"{niche_lower} —Å–∫–∏–¥–∫–∏",
            f"{niche_lower} –∞–∫—Ü–∏–∏",
            f"{niche_lower} —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞",
            f"{niche_lower} –Ω–æ–≤–∏–Ω–∫–∏",
            f"{niche_lower} –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ",
            f"{niche_lower} —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏",
            f"{niche_lower} —Å–æ–≤–µ—Ç—ã",
        ]
        keywords.extend(variations)
    
    return {
        'success': True,
        'keywords': keywords[:quantity],
        'total': min(len(keywords), quantity),
        'fallback': True
    }


print("‚úÖ ai/keywords_generator.py –∑–∞–≥—Ä—É–∂–µ–Ω")
